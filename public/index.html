
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘åˆ—è¡¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 50;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            position: relative;
            z-index: 51;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .nav-container {
            position: relative;
            z-index: 40;
        }
        .video-platform-tag {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 2px 8px;
            border-radius: 4px;
            color: white;
            font-size: 12px;
            backdrop-filter: blur(4px);
            background-color: rgba(0,0,0,0.5);
            z-index: 1;
        }
        /* æ·»åŠ åˆ†ç±»é€‰æ‹©æ¡†æ ·å¼ */
        #platformFilter {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1em;
            padding-right: 2rem;
        }

        #platformFilter:focus {
            outline: none;
            color: rgba(59, 130, 246, 0.5);
        }

        .platform-bilibili { border-left: 3px solid #FB7299; }
        .platform-douyin { border-left: 3px solid #000000; }
        .platform-youtube { border-left: 3px solid #FF0000; }
        
        .video-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        .video-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .video-card .play-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translate(-50%, -50%) scale(0.8);
        }
        .video-card:hover .play-button {
            transform: translate(-50%, -50%) scale(1);
            background-color: rgba(255,255,255,0.95);
        }
        .video-thumbnail {
            position: relative;
            padding-top: 56.25%; /* 16:9 å®½é«˜æ¯” */
            overflow: hidden;
        }
        .video-thumbnail img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .video-thumbnail::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(0deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0) 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .video-card:hover .video-thumbnail::after {
            opacity: 1;
        }
        .line-clamp-1 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
        }
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
        }
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255,255,255,0.9);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .video-card:hover .play-button {
            opacity: 1;
        }
        @media (max-width: 640px) {
            .container {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
            .video-card {
                font-size: 0.875rem;
            }
            .video-info {
                padding: 0.5rem;
            }
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* æ‰‹æœºç«¯é»˜è®¤2åˆ— */
            gap: 0.5rem;
            padding: 0.5rem;
        }

        /* sm (640px) ä»¥ä¸Šä¿æŒ2åˆ— */
        @media (min-width: 640px) {
            .video-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
                padding: 1rem;
            }
        }

        /* md (768px) ä»¥ä¸Š3åˆ— */
        @media (min-width: 768px) {
            .video-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* lg (1024px) ä»¥ä¸Š4åˆ— */
        @media (min-width: 1024px) {
            .video-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* xl (1280px) ä»¥ä¸Š5åˆ— */
        @media (min-width: 1280px) {
            .video-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        /* æ·»åŠ åŠ è½½åŠ¨ç”»æ ·å¼ */
        .loading-spinner {
            display: none;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .loading-spinner.show {
            display: flex;
        }
        .spinner {
            width: 2rem;
            height: 2rem;
            border: 3px solid #e5e7eb;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* éª¨æ¶å±åŠ¨ç”» */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        .skeleton {
            animation: shimmer 2s infinite linear;
            background: linear-gradient(to right, #f6f7f8 4%, #edeef1 25%, #f6f7f8 36%);
            background-size: 1000px 100%;
        }

        /* åŠ è½½æ›´å¤šæç¤ºä¼˜åŒ– */
        .load-more-trigger {
            text-align: center;
            padding: 1rem;
            margin-top: 1rem;
            color: #666;
            font-size: 0.875rem;
        }
        .platform-douyin { border-left: 3px solid #000000; } /* æŠ–éŸ³é»‘ */
        .platform-bilibili { border-left: 3px solid #FB7299; } /* å“”å“©ç²‰ */
        .platform-twitter { border-left: 3px solid #1DA1F2; }
        .platform-youtube { border-left: 3px solid #FF0000; }
        .platform-instagram { border-left: 3px solid #E1306C; }

        /* æœç´¢æ¡†ä¼˜åŒ– */
        .search-container {
            position: relative;
        }

        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9CA3AF;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-lg p-4 nav-container">
        <div class="container mx-auto">
            <div class="flex justify-between items-center">
                <h1 id="mainTitle" class="text-2xl font-bold text-blue-600">æ— åå°ç«™</h1>
                <div class="flex items-center gap-2 sm:gap-4 flex-1 sm:flex-none sm:w-1/2 ml-4">
                <select id="platformFilter" 
                    class="w-24 sm:w-32 px-2 py-1 border rounded-md bg-white text-sm">
                <option value="">å…¨éƒ¨</option>
                <option value="æŠ–éŸ³">æŠ–éŸ³</option>
                <option value="å“”å“©">å“”å“©å“”å“©</option>
                <option value="twitter">Twitter</option>
                <option value="youtube">YouTube</option>
                <option value="instagram">Instagram</option>
            </select>
                    <input type="search" 
                           id="searchInput"
                           placeholder="æœç´¢..." 
                           class="w-full px-2 sm:px-4 py-1 sm:py-2 text-sm sm:text-base rounded-full border border-gray-300 focus:outline-none focus:border-blue-500">
                    <button onclick="openSubmitModal()" class="p-2 sm:px-4 sm:py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 flex-shrink-0">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                    </button>
                    <button onclick="openSettings()" class="p-2 sm:px-4 sm:py-2 bg-gray-100 rounded-full hover:bg-gray-200 flex-shrink-0">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- è®¾ç½®æ¨¡æ€æ¡† -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[100]">
        <div class="bg-white rounded-lg w-full max-w-lg relative z-[101]">
            <div class="p-4 border-b">
                <h2 class="text-xl font-bold">è®¾ç½®</h2>
            </div>
            <div class="p-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">ç½‘ç«™æ ‡é¢˜</label>
                    <input type="text" id="siteTitle" class="w-full px-3 py-2 border rounded" placeholder="è¯·è¾“å…¥ç½‘ç«™æ ‡é¢˜">
                </div>
                
                <!-- æœåŠ¡å™¨åˆ—è¡¨ -->
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-gray-700 text-sm font-bold">æœåŠ¡å™¨åˆ—è¡¨</label>
                        <button onclick="addServer()" class="px-2 py-1 bg-blue-500 text-white rounded text-sm">æ·»åŠ æœåŠ¡å™¨</button>
                    </div>
                    <div id="serverList" class="space-y-4">
                        <!-- æœåŠ¡å™¨é…ç½®é¡¹ä¼šåŠ¨æ€æ’å…¥è¿™é‡Œ -->
                    </div>
                </div>

                <!-- å½“å‰é€‰ä¸­çš„æœåŠ¡å™¨ -->
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">å½“å‰ä½¿ç”¨çš„æœåŠ¡å™¨</label>
                    <select id="currentServer" class="w-full px-3 py-2 border rounded">
                        <option value="">è¯·é€‰æ‹©æœåŠ¡å™¨</option>
                    </select>
                </div>
            </div>
            <div class="p-4 border-t flex justify-end space-x-2">
                <button onclick="closeSettingsModal()" class="px-4 py-2 border rounded">å–æ¶ˆ</button>
                <button onclick="saveSettings()" class="px-4 py-2 bg-blue-500 text-white rounded">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- æäº¤é“¾æ¥å¼¹çª— -->
    <div id="submitModal" class="modal">
        <div class="modal-content m-auto bg-white p-6 w-96">
            <h2 class="text-xl font-bold mb-4">æäº¤è§†é¢‘é“¾æ¥</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">è§†é¢‘é“¾æ¥æˆ–åˆ†äº«å£ä»¤</label>
                    <input type="text" id="videoUrl" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="è¯·è¾“å…¥è§†é¢‘é“¾æ¥æˆ–åˆ†äº«å£ä»¤">
                </div>
                <div class="flex justify-end space-x-3">
                    <button onclick="closeSubmitModal()" class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200">å–æ¶ˆ</button>
                    <button onclick="submitVideo()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">æäº¤</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¡®è®¤æäº¤å¼¹çª— -->
    <div id="confirmModal" class="modal">
        <div class="modal-content m-auto bg-white p-6 w-96">
            <h2 class="text-xl font-bold mb-4">æ£€æµ‹åˆ°è§†é¢‘é“¾æ¥</h2>
            <div class="space-y-4">
                <p class="text-gray-600 break-all" id="clipboardContent"></p>
                <div class="flex justify-end space-x-3">
                    <button onclick="closeConfirmModal()" class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200">å–æ¶ˆ</button>
                    <button onclick="confirmSubmit()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">æäº¤</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="container mx-auto py-4 sm:py-8">
        <!-- æœåŠ¡å™¨æœªé…ç½®æç¤º -->
        <div id="configError" class="hidden">
            <div class="flex flex-col items-center justify-center p-8 bg-white rounded-lg shadow-sm">
                <svg class="w-16 h-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                <h2 class="text-xl font-semibold text-gray-900 mb-2">æœªé…ç½®æœåŠ¡å™¨</h2>
                <p class="text-gray-600 text-center mb-4">è¯·å…ˆé…ç½®æœåŠ¡å™¨åœ°å€å’ŒToken</p>
                <button onclick="openSettings()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    å‰å¾€è®¾ç½®
                </button>
            </div>
        </div>

        <!-- æ•°æ®ä¸ºç©ºæç¤º -->
        <div id="emptyState" class="hidden">
            <div class="flex flex-col items-center justify-center p-8 bg-white rounded-lg shadow-sm">
                <svg class="w-16 h-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"></path>
                </svg>
                <h2 class="text-xl font-semibold text-gray-900 mb-2">æš‚æ— è§†é¢‘</h2>
                <p class="text-gray-600 text-center">å½“å‰æ²¡æœ‰æ‰¾åˆ°ä»»ä½•è§†é¢‘</p>
            </div>
        </div>

        <!-- éª¨æ¶å± -->
        <div id="skeletonLoader" class="video-grid">
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded"></div>
                    <div class="skeleton h-3 w-1/2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 rounded"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded"></div>
                    <div class="skeleton h-3 w-1/2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 rounded"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded"></div>
                    <div class="skeleton h-3 w-1/2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 rounded"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded"></div>
                    <div class="skeleton h-3 w-1/2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 rounded"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded"></div>
                    <div class="skeleton h-3 w-1/2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 rounded"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded"></div>
                    <div class="skeleton h-3 w-1/2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 rounded"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded"></div>
                    <div class="skeleton h-3 w-1/2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 rounded"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded"></div>
                    <div class="skeleton h-3 w-1/2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 rounded"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded"></div>
                    <div class="skeleton h-3 w-1/2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 rounded"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded"></div>
                    <div class="skeleton h-3 w-1/2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 rounded"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded"></div>
                    <div class="skeleton h-3 w-1/2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 rounded"></div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded"></div>
                    <div class="skeleton h-3 w-1/2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 rounded"></div>
                </div>
            </div>
            
        </div>

        <div id="videoList" class="video-grid hidden">
            <!-- è§†é¢‘å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
        </div>
        
        <!-- åŠ è½½åŠ¨ç”»ä¼˜åŒ– -->
        <div id="loadingSpinner" class="loading-spinner">
            <div class="spinner"></div>
            <p class="mt-2 text-sm text-gray-600">åŠ è½½ä¸­...</p>
        </div>

        <!-- åŠ è½½æ›´å¤šæç¤º -->
        <div id="loadMoreTrigger" class="load-more-trigger hidden">
            <p>ä¸‹æ‹‰åŠ è½½æ›´å¤š</p>
        </div>
    </div>

    <script>
        let currentPage = 1;
        let pageSize = 12;  // é»˜è®¤é¡µå¤§å°
        let searchTimeout;
        let totalPages = 1;
        let isLoading = false;
        let hasMore = true;
        let currentClipboardContent = '';
        let currentPlatform = '';
        // æœåŠ¡å™¨é…ç½®ç›¸å…³å‡½æ•°
        let servers = [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            adjustPageSize();
            window.addEventListener('resize', debounce(adjustPageSize, 250));
            loadSettings();
            loadVideos();  // æ¢å¤åˆå§‹åŠ è½½
            setupSearchHandler();
            setupScrollHandler();
            setupClipboardListener();
            document.getElementById('platformFilter').addEventListener('change', function() {
            currentPlatform = this.value; // è®°å½•é€‰ä¸­çš„å¹³å°
            currentPage = 1; // é‡ç½®é¡µç 
            document.getElementById('videoList').innerHTML = ''; // æ¸…ç©ºå½“å‰åˆ—è¡¨
            loadVideos(); // é‡æ–°åŠ è½½
          });
        });

        // è°ƒæ•´é¡µé¢å¤§å°
        function adjustPageSize() {
            const container = document.querySelector('.video-grid');
            if (!container) return;

            // è·å–å®¹å™¨å®½åº¦å’Œè®¡ç®—åˆ—æ•°
            const containerWidth = container.offsetWidth;
            const gap = 16; // gapçš„å®é™…å€¼ï¼Œæ ¹æ®tailwindçš„é…ç½®å¯èƒ½ä¸åŒ
            let columns;

            // æ ¹æ®å®¹å™¨å®½åº¦è®¡ç®—åˆ—æ•°ï¼Œä¸CSSä¸­çš„åª’ä½“æŸ¥è¯¢breakpointsä¿æŒä¸€è‡´
            if (containerWidth >= 1280) columns = 5;      // xl
            else if (containerWidth >= 1024) columns = 4; // lg
            else if (containerWidth >= 768) columns = 3;  // md
            else if (containerWidth >= 640) columns = 2;  // sm
            else columns = 2;                             // é»˜è®¤

            // è®¡ç®—è¡Œæ•°ï¼ˆè€ƒè™‘åˆ°ä¸€èˆ¬æ˜¾ç¤ºå™¨é«˜åº¦ï¼Œé»˜è®¤2è¡Œï¼‰
            const rows = Math.max(2, Math.floor((window.innerHeight - 200) / 250)); // 200æ˜¯å¤´éƒ¨åŒºåŸŸé«˜åº¦ï¼Œ250æ˜¯å¡ç‰‡é¢„ä¼°é«˜åº¦

            // è®¡ç®—éœ€è¦åŠ è½½çš„æ•°é‡
            const newPageSize = columns * rows;
            
            // å¦‚æœé¡µé¢å¤§å°å‘ç”Ÿå˜åŒ–ï¼Œé‡æ–°åŠ è½½
            if (newPageSize !== pageSize) {
                pageSize = newPageSize;
                // åªæœ‰å½“å·²ç»æœ‰å†…å®¹æ—¶æ‰é‡æ–°åŠ è½½
                if (document.getElementById('videoList').children.length > 0) {
                    currentPage = 1;
                    loadVideos();
                }
            }
        }

        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // åŠ è½½è®¾ç½®
        function loadSettings() {
            const siteTitle = localStorage.getItem('siteTitle') || 'è§†é¢‘ç«™';
            document.getElementById('siteTitle').value = siteTitle;
            document.getElementById('mainTitle').textContent = siteTitle;
            document.title = siteTitle;

            // åŠ è½½æœåŠ¡å™¨åˆ—è¡¨
            servers = JSON.parse(localStorage.getItem('servers') || '[]');
            if (servers.length === 0) {
                // å¦‚æœæ²¡æœ‰æœåŠ¡å™¨é…ç½®,å°†åŸæ¥çš„é…ç½®è½¬æ¢ä¸ºæ–°æ ¼å¼
                const oldServerUrl = localStorage.getItem('serverUrl');
                const oldApiToken = localStorage.getItem('apiToken');
                if (oldServerUrl && oldApiToken) {
                    servers.push({
                        name: 'é»˜è®¤æœåŠ¡å™¨',
                        url: oldServerUrl,
                        token: oldApiToken
                    });
                }
            }

            // åŠ è½½å½“å‰é€‰ä¸­çš„æœåŠ¡å™¨
            const currentServerId = localStorage.getItem('currentServerId') || '0';
            
            // æ›´æ–°ç•Œé¢
            updateServerList();
            updateCurrentServerSelect();
            
            // è®¾ç½®å½“å‰æœåŠ¡å™¨
            document.getElementById('currentServer').value = currentServerId;
        }

        // æ·»åŠ æ–°æœåŠ¡å™¨
        function addServer() {
            servers.push({
                name: `æœåŠ¡å™¨ ${servers.length + 1}`,
                url: '',
                token: ''
            });
            updateServerList();
            updateCurrentServerSelect();
        }

        // åˆ é™¤æœåŠ¡å™¨
        function deleteServer(index) {
            servers.splice(index, 1);
            updateServerList();
            updateCurrentServerSelect();
        }

        // æ›´æ–°æœåŠ¡å™¨åˆ—è¡¨æ˜¾ç¤º
        function updateServerList() {
            const serverList = document.getElementById('serverList');
            serverList.innerHTML = servers.map((server, index) => `
                <div class="p-4 border rounded">
                    <div class="flex justify-between items-center mb-2">
                        <input type="text" 
                               class="border-none font-bold" 
                               value="${server.name}"
                               onchange="updateServerName(${index}, this.value)"
                               placeholder="æœåŠ¡å™¨åç§°">
                        <button onclick="deleteServer(${index})" 
                                class="text-red-500 hover:text-red-700">
                            åˆ é™¤
                        </button>
                    </div>
                    <div class="space-y-2">
                        <input type="text" 
                               class="w-full px-3 py-2 border rounded" 
                               value="${server.url}"
                               onchange="updateServerUrl(${index}, this.value)"
                               placeholder="æœåŠ¡å™¨åœ°å€">
                        <input type="text" 
                               class="w-full px-3 py-2 border rounded" 
                               value="${server.token}"
                               onchange="updateServerToken(${index}, this.value)"
                               placeholder="API Token">
                    </div>
                </div>
            `).join('');
        }

        // æ›´æ–°å½“å‰æœåŠ¡å™¨é€‰æ‹©ä¸‹æ‹‰æ¡†
        function updateCurrentServerSelect() {
            const select = document.getElementById('currentServer');
            select.innerHTML = `
                <option value="">è¯·é€‰æ‹©æœåŠ¡å™¨</option>
                ${servers.map((server, index) => `
                    <option value="${index}">${server.name}</option>
                `).join('')}
            `;
        }

        // æ›´æ–°æœåŠ¡å™¨åç§°
        function updateServerName(index, name) {
            servers[index].name = name;
        }

        // æ›´æ–°æœåŠ¡å™¨åœ°å€
        function updateServerUrl(index, url) {
            servers[index].url = url;
        }

        // æ›´æ–°æœåŠ¡å™¨Token
        function updateServerToken(index, token) {
            servers[index].token = token;
        }

        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            const siteTitle = document.getElementById('siteTitle').value || 'è§†é¢‘ç«™';
            const currentServerId = document.getElementById('currentServer').value;

            // ä¿å­˜ç½‘ç«™æ ‡é¢˜
            localStorage.setItem('siteTitle', siteTitle);
            document.getElementById('mainTitle').textContent = siteTitle;
            document.title = siteTitle;

            // ä¿å­˜æœåŠ¡å™¨é…ç½®
            localStorage.setItem('servers', JSON.stringify(servers));
            localStorage.setItem('currentServerId', currentServerId);

            // å¦‚æœé€‰æ‹©äº†æœåŠ¡å™¨,åŒæ—¶æ›´æ–°å½“å‰ä½¿ç”¨çš„æœåŠ¡å™¨åœ°å€å’Œtoken
            if (currentServerId !== '') {
                const currentServer = servers[currentServerId];
                localStorage.setItem('serverUrl', currentServer.url);
                localStorage.setItem('apiToken', currentServer.token);
            }

            closeSettingsModal();
            // åˆ·æ–°è§†é¢‘åˆ—è¡¨
            loadVideos();
        }

        // è®¾ç½®æ»šåŠ¨å¤„ç†
        function setupScrollHandler() {
            window.addEventListener('scroll', () => {
                if (isLoading || !hasMore) return;
                
                const scrollHeight = document.documentElement.scrollHeight;
                const scrollTop = window.scrollY || document.documentElement.scrollTop;
                const clientHeight = window.innerHeight || document.documentElement.clientHeight;
                
                // å½“è·ç¦»åº•éƒ¨100pxæ—¶åŠ è½½æ›´å¤š
                if (scrollHeight - scrollTop - clientHeight < 100) {
                    loadMore();
                }
            });
        }

        // è®¾ç½®æœç´¢å¤„ç†
        
        function setupSearchHandler() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                
                // ğŸ”¼ğŸ”¼ğŸ”¼ æ–°å¢ä»¥ä¸‹ä¸‰è¡Œ ğŸ”¼ğŸ”¼ğŸ”¼
                currentPage = 1; // æœç´¢æ—¶é‡ç½®é¡µç 
                document.getElementById('videoList').innerHTML = ''; // æ¸…ç©ºå½“å‰åˆ—è¡¨
                document.getElementById('skeletonLoader').classList.remove('hidden'); // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
                
                searchTimeout = setTimeout(() => {
                    loadVideos();
                }, 500);
            });
        }

        // åŠ è½½æ›´å¤šè§†é¢‘
        async function loadMore() {
            if (currentPage < totalPages) {
                currentPage++;
                await loadVideos(true);
            }
        }

        // æ˜¾ç¤º/éšè—åŠ è½½åŠ¨ç”»
        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            if (show) {
                spinner.classList.add('show');
            } else {
                spinner.classList.remove('show');
            }
            isLoading = show;
        }

        // åŠ è½½è§†é¢‘åˆ—è¡¨
async function loadVideos(append = false) {
  const searchQuery = document.getElementById('searchInput').value.toLowerCase();
  const serverConfig = getServerConfig();
  
  if (!serverConfig) return;
  if (!append) { // å¦‚æœæ˜¯å…¨æ–°åŠ è½½ï¼ˆéåŠ è½½æ›´å¤šï¼‰
        currentPage = 1;
        document.getElementById('videoList').innerHTML = '';
    }
  isLoading = true;
  showLoading(true);

  try {
    // æ”¹ä¸ºGETè¯·æ±‚å¹¶æ‹¼æ¥å‚æ•°
    const response = await axios.get('/api/findVideos', {
      params: {
        serverUrl: serverConfig.url,
        token: serverConfig.token,
        pageNo: currentPage,
        pageSize: pageSize,
        searchQuery: searchQuery,
        videoplatform: currentPlatform // æ·»åŠ å¹³å°è¿‡æ»¤
      }
    });

                if (response.data.resCode === '000001') {
                    const { content, totalPages: total } = response.data.record;
                    totalPages = total;
                    hasMore = currentPage < total;

                    if (!content || content.length === 0) {
                        if (!append) {
                            document.getElementById('emptyState').classList.remove('hidden');
                            document.getElementById('videoList').classList.add('hidden');
                            document.getElementById('skeletonLoader').classList.add('hidden');
                        }
                        return;
                    }

                    document.getElementById('emptyState').classList.add('hidden');
                    document.getElementById('skeletonLoader').classList.add('hidden');
                    document.getElementById('videoList').classList.remove('hidden');
                    
                    if (append) {
                        appendVideos(content);
                    } else {
                        renderVideos(content);
                    }

                    // æ˜¾ç¤ºåŠ è½½æ›´å¤šæç¤º
                    document.getElementById('loadMoreTrigger').classList.toggle('hidden', !hasMore);
                } else {
                    throw new Error(response.data.message);
                }
            } catch (error) {
                console.error('åŠ è½½è§†é¢‘å¤±è´¥:', error);
                showMessage(error.response?.data?.message || 'åŠ è½½è§†é¢‘å¤±è´¥');
            } finally {
                isLoading = false;
                showLoading(false);
            }
        }

        // æ¸²æŸ“è§†é¢‘åˆ—è¡¨
        function renderVideos(videos) {
            const videoList = document.getElementById('videoList');
            videoList.innerHTML = generateVideoCards(videos);
        }

        // è¿½åŠ è§†é¢‘åˆ—è¡¨
        function appendVideos(videos) {
            const videoList = document.getElementById('videoList');
            videoList.insertAdjacentHTML('beforeend', generateVideoCards(videos));
        }

        // ç”Ÿæˆè§†é¢‘å¡ç‰‡HTML
       
        function generateVideoCards(videos) {
            return videos.map(video => {
                // ä¼˜å…ˆä½¿ç”¨videounrealaddrå­—æ®µ
                const videoUrl = video.videounrealaddr || video.videoaddr || video.videourl;
                
                // æ„é€ å¸¦_rawçš„å®Œæ•´æ•°æ®
                const safeData = {
                    videourl: videoUrl,
                    _raw: video // åŒ…å«åŸå§‹æ•°æ®
                };

                // è½¬æ¢ä¸ºURIç¼–ç å­—ç¬¦ä¸²
                const encodedData = encodeURIComponent(JSON.stringify(safeData));
                
                return `
                <div class="video-card bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-lg">
                    <a onclick="setPlayVideo(this)" class="block cursor-pointer" data-video="${encodedData}">
                        <div class="video-thumbnail">
                            <img src="${addTokenToUrl(video.videocover)}" alt="${video.videoname}" loading="lazy">
                            <div class="video-platform-tag ${getPlatformClass(video.videoplatform)}">${video.videoplatform}</div>
                            <div class="play-button">
                                <svg class="w-6 h-6 sm:w-8 sm:h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                        </div>
                        <div class="video-info p-2 sm:p-3">
                            <h3 class="text-sm sm:text-base font-medium text-gray-900 line-clamp-2 mb-1" title="${video.videoname}">${video.videoname}</h3>
                            <div class="flex items-center text-xs text-gray-500 mb-1 sm:mb-2">
                                <span class="flex items-center">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                    </svg>
                                    ${video.videoplatform}
                                </span>
                                <span class="mx-1 sm:mx-2">â€¢</span>
                                <span class="flex items-center">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                    </svg>
                                    ${formatDate(video.createtime)}
                                </span>
                            </div>
                            <p class="text-xs text-gray-500 line-clamp-1" title="${video.videodesc || 'æš‚æ— æè¿°'}">${video.videodesc || 'æš‚æ— æè¿°'}</p>
                        </div>
                    </a>
                </div>
            `;
            }).join('');
        }

        // è·å–å¹³å°æ ‡ç­¾æ ·å¼

        function getPlatformClass(platform) {
            const platformMap = {
                'æŠ–éŸ³': 'platform-douyin',     // æŠ–éŸ³
                'å“”å“©': 'platform-bilibili', // å“”å“©å“”å“©
                'twitter': 'platform-twitter',   // Twitter
                'youtube': 'platform-youtube',   // YouTube
                'instagram': 'platform-instagram'// Instagram
            };
            return platformMap[platform.toLowerCase()] || '';
        }


        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            const date = new Date(dateString);
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        // æ·»åŠ tokenåˆ°URL
        function addTokenToUrl(url) {
            const serverConfig = getServerConfig();
            if (!url || !serverConfig) return url;
            
            // å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œæ·»åŠ æœåŠ¡å™¨åœ°å€
            const fullUrl = url.startsWith('/') ? `${serverConfig.url}${url}` : url;
            return `${fullUrl}?apptoken=${serverConfig.token}`;
        }

        // æ‰“å¼€è®¾ç½®å¼¹çª—
        function openSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        // å…³é—­è®¾ç½®å¼¹çª—
        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
        function showMessage(message, isError = true) {
            // åˆ›å»ºæ¶ˆæ¯å…ƒç´ 
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-white ${isError ? 'bg-red-500' : 'bg-green-500'} shadow-lg z-50`;
            messageDiv.textContent = message;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(messageDiv);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);

            // å¦‚æœæ˜¯é”™è¯¯æ¶ˆæ¯ï¼ŒåŒæ—¶æ˜¾ç¤ºé…ç½®é”™è¯¯ç•Œé¢
            if (isError) {
                document.getElementById('configError').classList.remove('hidden');
                document.getElementById('videoList').classList.add('hidden');
                document.getElementById('skeletonLoader').classList.add('hidden');
            }
        }

        // ä¿®æ”¹è·å–æœåŠ¡å™¨é…ç½®çš„æ–¹å¼
        function getServerConfig() {
            const currentServerId = localStorage.getItem('currentServerId');
            if (!currentServerId || !servers[currentServerId]) {
                showMessage('è¯·å…ˆåœ¨è®¾ç½®ä¸­é€‰æ‹©æœåŠ¡å™¨');
                return null;
            }
            return servers[currentServerId];
        }

        // è®¾ç½®å‰ªåˆ‡æ¿ç›‘å¬
        function setupClipboardListener() {
            document.addEventListener('paste', async (e) => {
                // å¦‚æœå½“å‰æœ‰å¼¹çª—æ‰“å¼€ï¼Œä¸å¤„ç†å‰ªåˆ‡æ¿äº‹ä»¶
                if (document.querySelector('.modal.show')) return;
                
                const clipText = (e.clipboardData || window.clipboardData).getData('text');
                if (!clipText) return;
                
                // åªæ£€æŸ¥æ˜¯å¦åŒ…å«http://æˆ–https://
                const isLink = /^https?:\/\//.test(clipText.trim());
                
                if (isLink && clipText !== currentClipboardContent) {
                    currentClipboardContent = clipText;
                    showConfirmModal(clipText);
                }
            });

            // ç›‘å¬é¡µé¢è·å¾—ç„¦ç‚¹äº‹ä»¶
            window.addEventListener('focus', async () => {
                try {
                    // å¦‚æœå½“å‰æœ‰å¼¹çª—æ‰“å¼€ï¼Œä¸è¯»å–å‰ªåˆ‡æ¿
                    if (document.querySelector('.modal.show')) return;
                    
                    const clipText = await navigator.clipboard.readText();
                    if (!clipText || clipText === currentClipboardContent) return;
                    
                    // åªæ£€æŸ¥æ˜¯å¦åŒ…å«http://æˆ–https://
                    const isLink = /^https?:\/\//.test(clipText.trim());
                    
                    if (isLink) {
                        currentClipboardContent = clipText;
                        showConfirmModal(clipText);
                    }
                } catch (err) {
                    console.error('è¯»å–å‰ªåˆ‡æ¿å¤±è´¥:', err);
                }
            });
        }

        // æ˜¾ç¤ºç¡®è®¤å¼¹çª—
        function showConfirmModal(content) {
            document.getElementById('clipboardContent').textContent = content;
            document.getElementById('confirmModal').classList.add('show');
        }

        // å…³é—­ç¡®è®¤å¼¹çª—
        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('show');
        }

        // ç¡®è®¤æäº¤
        function confirmSubmit() {
            const content = document.getElementById('clipboardContent').textContent;
            document.getElementById('videoUrl').value = content;
            closeConfirmModal();
            openSubmitModal();
        }

        // æ‰“å¼€æäº¤å¼¹çª—
        function openSubmitModal() {
            document.getElementById('submitModal').classList.add('show');
            document.getElementById('videoUrl').value = '';
        }

        // å…³é—­æäº¤å¼¹çª—
        function closeSubmitModal() {
            document.getElementById('submitModal').classList.remove('show');
        }

        // æäº¤è§†é¢‘
        async function submitVideo() {
        try {
            const serverConfig = getServerConfig();
            if (!serverConfig) {
            alert('è¯·å…ˆé€‰æ‹©æœåŠ¡å™¨');
            return;
            }

            const videoUrl = document.getElementById('videoUrl').value.trim();
            if (!videoUrl) {
            alert('è¯·è¾“å…¥è§†é¢‘é“¾æ¥æˆ–åˆ†äº«å£ä»¤');
            return;
            }

            // ä½¿ç”¨URLSearchParamså¤„ç†å‚æ•°
            const params = new URLSearchParams();
            params.append('token', serverConfig.token);
            params.append('video', videoUrl);

            const response = await axios.post('/api/processingVideos', params, {
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            }
            });

            if (response.data.resCode === '000001') {
            alert('æäº¤æˆåŠŸ');
            closeSubmitModal();
            currentPage = 1;
            loadVideos();
            } else {
            throw new Error(response.data.message);
            }
        } catch (error) {
            console.error('æäº¤è§†é¢‘å¤±è´¥:', error);
            alert('æäº¤å¤±è´¥: ' + (error.response?.data?.message || error.message));
        }
        }

        // ä½¿ç”¨ Intersection Observer ä¼˜åŒ–æ— é™æ»šåŠ¨
        const observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting && !isLoading && hasMore) {
                loadMore();
            }
        }, {
            rootMargin: '100px'
        });

        // è®¾ç½®è§‚å¯Ÿè€…
        document.addEventListener('DOMContentLoaded', () => {
            const trigger = document.getElementById('loadMoreTrigger');
            if (trigger) {
                observer.observe(trigger);
            }
        });

        // è®¾ç½®è¦æ’­æ”¾çš„è§†é¢‘
        // ä¿®æ”¹setPlayVideoæ–¹æ³•
        function setPlayVideo(element) {
            try {
                // è·å–æœåŠ¡å™¨é…ç½®
                const serverConfig = getServerConfig();
                if (!serverConfig) {
                    alert('æœåŠ¡å™¨é…ç½®é”™è¯¯');
                    return;
                }

                // è·å–åŸå§‹è§†é¢‘æ•°æ®
                const rawData = element.dataset.video;
                
                // åŒé‡éªŒè¯ç¼–ç æ ¼å¼
                let videoData;
                try {
                    // å°è¯•ç›´æ¥è§£æï¼ˆåº”å¯¹æœªç¼–ç æƒ…å†µï¼‰
                    videoData = JSON.parse(rawData);
                } catch {
                    // è§£ç URIç¼–ç æ ¼å¼
                    videoData = JSON.parse(decodeURIComponent(rawData));
                }

                // å­˜å‚¨æ•°æ®ï¼ˆæ–°æ ¼å¼ï¼‰
                localStorage.setItem('playVideo', JSON.stringify(videoData));
                localStorage.setItem('currentServerConfig', JSON.stringify(serverConfig));
                
                // æ·»åŠ å»¶è¿Ÿç¡®ä¿å­˜å‚¨å®Œæˆ
                setTimeout(() => {
                    window.location.href = '/play';
                }, 50);
            } catch (error) {
                console.error('è·³è½¬æ’­æ”¾é¡µå¤±è´¥:', error);
                alert('è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°');
            }
            return false;
        }

    </script>
</body>
</html> 